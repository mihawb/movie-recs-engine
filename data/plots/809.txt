When Shrek and Fiona come back from their honeymoon, they find an invitation to a royal ball with Fiona's parents to celebrate their marriage, an event Shrek is reluctant to participate in. Fiona talks him into it, and along with Donkey, they travel to the kingdom of Far Far Away. They meet Fiona's parents, King Harold and Queen Lillian, who are surprised and repulsed by Fiona's choice of husband (particularly the King himself), since they had arranged that Prince Charming rescue her from the castle but now they see that her husband is an ogre.At a shared meal, Shrek and Harold get into a heated argument over how Shrek and Fiona will raise their family, and Fiona, disgusted at Shrek and her father's behaviour, locks herself away in her room that evening, where she meets her Fairy Godmother, who is also surprised at Fiona's new looks. Shrek worries that he has lost his true love, particularly after finding her childhood diary and reading that she was once infatuated with Prince Charming.King Harold is accosted by the Fairy Godmother and Charming, her son. The two retell the Prince's adventures and how he overcame many obstacles and climbed a high tower in order to rescue her finding instead a crossdressing wolf. They reprimand Harold for breaking an old promise that Charming would be able to marry Fiona and demand that he find a way to get rid of Shrek. Harold arranges for Shrek and Donkey to join him on a fictitious hunting trip, which really is a trap to lure the two into the hands of an assassin, Puss in Boots.When Fiona realizes that Shrek left she asks her father for help but he replies that he always wanted the best for her and that she should better think about what is the best for her, too. Puss is unable to defeat Shrek and, revealing that he was paid by Harold, asks to come along as a way to make amends. The three sneak into the Fairy Godmother's potion factory and steal a "Happily Ever After" potion that Shrek believes will restore Fiona's love for him.Shrek and Donkey both drink the potion and fall into a deep sleep. The potion also affects Fiona who also faints. Awakening the next morning, he sees three ladies taking care of him and is shocked to discover its effects: Shrek is now a handsome human, while Donkey has turned into a stallion. In order to make the change permanent, Shrek must kiss Fiona by midnight.He, Donkey, and Puss return to the castle as Fiona awakens and sees her former, human self and she screams when she sees her reflection. However, the Fairy Godmother, having learned of the potion's theft, intercepts Shrek and sends Charming to pose as him and win her love. Shrek watches from inside, and calls for her at the window. At the Fairy Godmother's urging, Shrek leaves the castle, believing that the best way to make Fiona happy is to let her go.To ensure that Fiona falls in love with Charming, the Fairy Godmother gives Harold a love potion to put into Fiona's tea. But Harold replies that it's not possible to make his daughter fall in love in this way. This exchange is overheard by Shrek, Donkey, and Puss, who are soon arrested by the royal guards and thrown into a dungeon.While the royal ball begins, several of Shrek's friends band together to free the trio and create a gigantic gingerbread man (whose name is Mongo), which breaks through the castle's defenses so Shrek can stop Charming from kissing Fiona. He is too late to stop them; instead of falling in love with Charming, though, Fiona knocks him out with a headbutt. Harold reveals that he never gave Fiona the love potion, whereupon the Fairy Godmother attacks Shrek.The now-enraged Fairy Godmother tries to kill Shrek with her magic wand, but Harold jumps in front of it; the spell ricochets off his armor and disintegrates her. With the Fairy Godmother gone, Harold reverts back into the Frog Prince. Harold apologizes, admitting to using the "Happily Ever After" potion years earlier to gain Lillian's love, and approves Shrek and Fiona's marriage. Lillian assures Harold that she still loves him.As the clock strikes midnight, Fiona rejects Shrek's offer to remain human, and revert back into ogres, while Donkey also returns to normal.In a mid-credits scene: Dragon, who had previously married Donkey, reveals that they now have several dragon-donkey hybrid babies.